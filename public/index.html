<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Malden River Water Quality</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="http://dc-js.github.io/dc.js/css/dc.css">
  <link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="container">
  <h1>Water Quality Conditions on the Malden River</h1>

  <hr>

  <div class="step-nav">
    <div class="btn-group" role="group" aria-label="Steps">
      <button type="button" class="btn btn-default btn-step" id="step1">1</a>
      <button type="button" class="btn btn-default btn-step" id="step2">2</a>
      <button type="button" class="btn btn-default btn-step" id="step3">3</a>
      <button type="button" class="btn btn-default btn-step" id="step4">4</a>
      <button type="button" class="btn btn-default btn-step" id="step5">5</a>
      <button type="button" class="btn btn-default btn-step" id="step6">6</a>
      <button type="button" class="btn btn-default btn-step" id="step7">7</a>
      <button type="button" class="btn btn-default btn-step" id="step8">8</a>
      <button type="button" class="btn btn-default disabled" id="explore">Explore <i class="fa fa-angle-double-right" area-hidden="true"></i></a>
    </div>
  </div>

  <div class="stepper">
    <div class="annotation-container">
      <div class="annotation" id="step1-annotation" style="display:block">
        <h2>Sampling Location</h2>
        <p>Each month, MyRWA volunteers collect water quality samples throughout the Mystic River watershed as part of the <a href="http://mysticriver.org/baseline/" target="_blank">Baseline Water Quality Monitoring Program</a>.</p>
        <p>This map shows the monitoring station where samples are collected on the Malden River (Station ID: MAR036).</p>
        <div class="text-center" style="margin-top:20px">
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-default disabled"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Prev</a>
            <button type="button" class="btn btn-default" onclick="switchStep('step2')">Next <i class="fa fa-angle-double-right" aria-hidden="true"></i></a>
          </div>
        </div>
      </div>
      <div class="annotation" id="step2-annotation">
        <h2>E. coli Samples</h2>
        <p>Each water quality sample is analyzed for E. coli, which is a type of <a href="https://en.wikipedia.org/wiki/Indicator_bacteria" target="_blank">indicator bacteria</a>.</p>
        <p>Indicator bacteria are not necessarily harmful, but are used as indicators of public health risks. Their presence suggests that other, more harmful bacteria or viruses may also be present.</p>
        <p>The chart shows the E. coli levels of each sample collected on the Malden River over the past 14 years.</p>
        <p>But what do these levels mean? How often is the river safe for boating or other recreation?</p>
        <div class="text-center" style="margin-top:20px">
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-default" onclick="switchStep('step1')"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Prev</a>
            <button type="button" class="btn btn-default" onclick="switchStep('step3')">Next <i class="fa fa-angle-double-right" aria-hidden="true"></i></a>
          </div>
        </div>
      </div>
      <div class="annotation" id="step3-annotation">
        <h2>Boating Standard</h2>
        <p>Massachusetts has a water quality standard for E. coli that states no sample should exceed 1,260 #/100mL (red line) in waterways used for boating and other "secondary" recreational uses.</p>
        <p>Samples above the standard (in red) are called exceedences and indicate an unacceptably high level of public health risk.</p>
        <p>Samples below the standard (in blue) indicate a low public health risk when the river would be safe for boating.</p>
        <div class="text-center" style="margin-top:20px">
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-default" onclick="switchStep('step2')"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Prev</a>
            <button type="button" class="btn btn-default" onclick="switchStep('step4')">Next <i class="fa fa-angle-double-right" aria-hidden="true"></i></a>
          </div>
        </div>
      </div>
      <div class="annotation" id="step4-annotation">
        <h2>Exceedence Frequency</h2>
        <p>If we count the number of samples above and below the standard, and then divide by the total number of samples, then we can estimate the percent of time that bacteria levels are safe and unsafe.</p>
        <p>The donut chart shows the 30% of all samples over the past 14 years have E. coli levels exceeding the boating standard.</p>
        <p>Why do some days have higher levels than others? Is there a way to predict whether E. coli levels are safe or unsafe on any given day?</p>
        <div class="text-center" style="margin-top:20px">
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-default" onclick="switchStep('step3')"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Prev</a>
            <button type="button" class="btn btn-default" onclick="switchStep('step5')">Next <i class="fa fa-angle-double-right" aria-hidden="true"></i></a>
          </div>
        </div>
      </div>
      <div class="annotation" id="step5-annotation">
        <h2>E. coli vs. Rainfall</h2>
        <p>Rainfall is a good predictor of E. coli levels in urban rivers due to stormwater runoff, which often has high bacteria levels.</p>
        <p>This chart shows the relationship between E. coli and the total rainfall over the previous 48 hours of each sample.</p>
        <p>A threshold of 0.25 inches of rainfall is used to assign wet and dry weather conditions to each sample. The donut chart shows that 23% of all samples were collected under wet weather conditions.</p>
        <p>Do the wet weather samples tend to have higher E. coli levels and more exceedences than the dry weather samples?</p>
        <div class="text-center" style="margin-top:20px">
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-default" onclick="switchStep('step4')"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Prev</a>
            <button type="button" class="btn btn-default" onclick="switchStep('step6')">Next <i class="fa fa-angle-double-right" aria-hidden="true"></i></a>
          </div>
        </div>
      </div>
      <div class="annotation" id="step6-annotation">
        <h2>Wet Weather Exceedences</h2>
        <p>Based on the relationship between E. coli and 48-hour rainfall, it appears that a greater fraction of wet weather samples exceeded the boating standard than for dry weather samples.</p>
        <p>Click this button to select only the wet weather samples, which will remove the dry weather samples from the other charts.</p>
        <p><button class="btn btn-primary btn-block" onclick="selectWet()">Select Wet Weather Samples</button></p>
        <div id="step6-additional-annotation">
          <p>The donut chart in the lower right now shows that 70% of <em>wet weather</em> samples were above the boating standard, and only 30% were below.</p>
          <div class="text-center" style="margin-top:20px">
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-default" onclick="switchStep('step5')"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Prev</a>
              <button type="button" class="btn btn-default" onclick="switchStep('step7')">Next <i class="fa fa-angle-double-right" aria-hidden="true"></i></a>
            </div>
          </div>
        </div>
      </div>
      <div class="annotation" id="step7-annotation">
        <h2>Step 7</h2>
        <div class="text-center" style="margin-top:20px">
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-default" onclick="switchStep('step6')"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Prev</a>
            <button type="button" class="btn btn-default" onclick="switchStep('step8')">Next <i class="fa fa-angle-double-right" aria-hidden="true"></i></a>
          </div>
        </div>
      </div>
      <div class="annotation" id="step8-annotation">
        <h2>Step 8</h2>
        <div class="text-center" style="margin-top:20px">
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-default" onclick="switchStep('step7')"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Prev</a>
            <button type="button" class="btn btn-default disabled">Next <i class="fa fa-angle-double-right" aria-hidden="true"></i></a>
          </div>
        </div>
      </div>
    </div>
    <div class="chart-container">
      <div id="chart-ts" style="display:none;">
        <strong>E. coli Samples over Time</strong>
      </div>
      <div id="chart-exceed" style="display:none;">
        <strong>% of Samples Above/Below Standard</strong>
      </div>
      <div id="chart-precip" style="display:none;">
        <strong>E. coli Samples vs. Previous 48-hour Rainfall</strong>
      </div>
      <div id="chart-weather" style="display:none;">
        <strong>% of Samples with Dry/Wet Weather</strong>
      </div>
      <div id="slider-weather-container" style="display:none;">
        <div id="slider-weather"></div>
        <p>Rainfall Threshold: <span id="slider-weather-value"></span></p>
      </div>
    </div>
    <div class="loading">
      <p>Loading...</p>
      <p><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i></p>
    </div>
  </div>

  <hr>
  <p>Developed by <a href="http://walkerenvres.com">Walker Environmental Research, LLC</a> for the <a href="http://mysticriver.org">Mystic River Watershed Association</a></p>
</div>

<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script src="https://d3js.org/queue.v1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.js"></script>
<script src="http://dc-js.github.io/dc.js/js/dc.js"></script>
<script src="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>

<script src="app.js"></script>

<script>

$(document).ready(function () {
  initialize();
});

</script>
</body>
</html>